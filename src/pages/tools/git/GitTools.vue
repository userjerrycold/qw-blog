<template>
  <div class="tools-container">
    <div class="content-container">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold">Git å·¥å…·é›†</h1>
        <n-button @click="router.push('/tools')" size="small">
          <template #icon>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </template>
          è¿”å›å·¥å…·åˆ—è¡¨
        </n-button>
      </div>

      <n-tabs type="line" animated>
        <!-- Git å¸¸ç”¨å‘½ä»¤ -->
        <n-tab-pane name="commands" tab="å¸¸ç”¨å‘½ä»¤">
          <div class="command-section">
            <n-card title="åŸºç¡€æ“ä½œ" class="mb-4">
              <div class="command-grid">
                <div v-for="(cmd, index) in basicCommands" :key="index" class="command-item">
                  <div class="flex justify-between">
                    <div class="command-name">{{ cmd.name }}</div>
                    <n-button text size="small" @click="copyToClipboard(cmd.command)">
                      <template #icon>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M8 4V16C8 17.1 8.9 18 10 18H18C19.1 18 20 17.1 20 16V7.4L16.6 4H10C8.9 4 8 4.9 8 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M16 4V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M16 18V20C16 21.1 15.1 22 14 22H6C4.9 22 4 21.1 4 20V9C4 7.9 4.9 7 6 7H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </template>
                      å¤åˆ¶
                    </n-button>
                  </div>
                  <div class="command-code">{{ cmd.command }}</div>
                  <div class="command-desc">{{ cmd.description }}</div>
                </div>
              </div>
            </n-card>

            <n-card title="åˆ†æ”¯æ“ä½œ" class="mb-4">
              <div class="command-grid">
                <div v-for="(cmd, index) in branchCommands" :key="index" class="command-item">
                  <div class="flex justify-between">
                    <div class="command-name">{{ cmd.name }}</div>
                    <n-button text size="small" @click="copyToClipboard(cmd.command)">
                      <template #icon>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M8 4V16C8 17.1 8.9 18 10 18H18C19.1 18 20 17.1 20 16V7.4L16.6 4H10C8.9 4 8 4.9 8 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M16 4V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M16 18V20C16 21.1 15.1 22 14 22H6C4.9 22 4 21.1 4 20V9C4 7.9 4.9 7 6 7H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </template>
                      å¤åˆ¶
                    </n-button>
                  </div>
                  <div class="command-code">{{ cmd.command }}</div>
                  <div class="command-desc">{{ cmd.description }}</div>
                </div>
              </div>
            </n-card>

            <n-card title="é«˜çº§æ“ä½œ" class="mb-4">
              <div class="command-grid">
                <div v-for="(cmd, index) in advancedCommands" :key="index" class="command-item">
                  <div class="flex justify-between">
                    <div class="command-name">{{ cmd.name }}</div>
                    <n-button text size="small" @click="copyToClipboard(cmd.command)">
                      <template #icon>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M8 4V16C8 17.1 8.9 18 10 18H18C19.1 18 20 17.1 20 16V7.4L16.6 4H10C8.9 4 8 4.9 8 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M16 4V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M16 18V20C16 21.1 15.1 22 14 22H6C4.9 22 4 21.1 4 20V9C4 7.9 4.9 7 6 7H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </template>
                      å¤åˆ¶
                    </n-button>
                  </div>
                  <div class="command-code">{{ cmd.command }}</div>
                  <div class="command-desc">{{ cmd.description }}</div>
                </div>
              </div>
            </n-card>
          </div>
        </n-tab-pane>

        <!-- åˆ†æ”¯å›¾ç”Ÿæˆ -->
        <n-tab-pane name="branch-graph" tab="åˆ†æ”¯å›¾ç”Ÿæˆ">
          <n-card title="åˆ†æ”¯å›¾ç”Ÿæˆå™¨" class="mb-4">
            <div class="mb-4">
              <n-alert type="info">
                è¾“å…¥æ‚¨çš„åˆ†æ”¯ç»“æ„ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆ ASCII å›¾å½¢å±•ç¤ºåˆ†æ”¯åˆå¹¶å†å²
              </n-alert>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <h3 class="text-base font-medium mb-2">åˆ†æ”¯é…ç½®</h3>
                <n-form>
                  <n-form-item label="ä¸»åˆ†æ”¯åç§°">
                    <n-input v-model:value="branchGraphConfig.mainBranch" placeholder="main" />
                  </n-form-item>
                  
                  <n-form-item label="åˆ†æ”¯ä¸åˆå¹¶å®šä¹‰">
                    <n-input
                      v-model:value="branchGraphConfig.branchDefinition"
                      type="textarea"
                      :autosize="{ minRows: 6, maxRows: 10 }"
                      placeholder="æ¯è¡Œä¸€ä¸ªæ“ä½œï¼Œä¾‹å¦‚:
feature: main 50
bugfix: feature 30
merge bugfix feature
merge feature main"
                    />
                  </n-form-item>
                  
                  <n-form-item>
                    <n-button type="primary" @click="generateBranchGraph">ç”Ÿæˆåˆ†æ”¯å›¾</n-button>
                  </n-form-item>
                </n-form>
              </div>
              
              <div>
                <h3 class="text-base font-medium mb-2">ç”Ÿæˆçš„åˆ†æ”¯å›¾</h3>
                <div class="branch-graph-output">
                  <pre>{{ branchGraphOutput }}</pre>
                </div>
                <n-button class="mt-2" size="small" @click="copyToClipboard(branchGraphOutput)">
                  å¤åˆ¶åˆ†æ”¯å›¾
                </n-button>
              </div>
            </div>
          </n-card>
        </n-tab-pane>

        <!-- Commit æ¨¡æ¿ -->
        <n-tab-pane name="commit-template" tab="Commit æ¨¡æ¿">
          <n-card title="Commit æ¶ˆæ¯ç”Ÿæˆå™¨" class="mb-4">
            <div class="mb-4">
              <n-alert type="info">
                ç”Ÿæˆè§„èŒƒçš„ Git Commit æ¶ˆæ¯ï¼Œéµå¾ª Conventional Commits è§„èŒƒ
              </n-alert>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <h3 class="text-base font-medium mb-2">Commit é…ç½®</h3>
                <n-form>
                  <n-form-item label="ç±»å‹">
                    <n-select v-model:value="commitTemplate.type" :options="commitTypeOptions" />
                  </n-form-item>
                  
                  <n-form-item label="èŒƒå›´ (å¯é€‰)">
                    <n-input v-model:value="commitTemplate.scope" placeholder="auth" />
                  </n-form-item>
                  
                  <n-form-item label="ç®€çŸ­æè¿°">
                    <n-input v-model:value="commitTemplate.subject" placeholder="æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½" />
                  </n-form-item>
                  
                  <n-form-item label="è¯¦ç»†æè¿° (å¯é€‰)">
                    <n-input
                      v-model:value="commitTemplate.body"
                      type="textarea"
                      :autosize="{ minRows: 3, maxRows: 6 }"
                      placeholder="å®ç°äº†åŸºäºJWTçš„è®¤è¯ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç™»å½•è¡¨å•å’ŒTokenå­˜å‚¨ã€‚
æ·»åŠ äº†è®°ä½å¯†ç åŠŸèƒ½å’Œè‡ªåŠ¨ç™»å½•é€‰é¡¹ã€‚"
                    />
                  </n-form-item>
                  
                  <n-form-item label="é¡µè„šæ³¨é‡Š (å¯é€‰)">
                    <n-input v-model:value="commitTemplate.footer" placeholder="Closes #123" />
                  </n-form-item>
                  
                  <n-form-item>
                    <n-button type="primary" @click="generateCommitMessage">ç”Ÿæˆ Commit æ¶ˆæ¯</n-button>
                  </n-form-item>
                </n-form>
              </div>
              
              <div>
                <h3 class="text-base font-medium mb-2">ç”Ÿæˆçš„ Commit æ¶ˆæ¯</h3>
                <div class="commit-message-output">
                  <pre>{{ commitMessageOutput }}</pre>
                </div>
                <n-button class="mt-2" size="small" @click="copyToClipboard(commitMessageOutput)">
                  å¤åˆ¶ Commit æ¶ˆæ¯
                </n-button>
              </div>
            </div>
          </n-card>
        </n-tab-pane>
      </n-tabs>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { useRouter } from 'vue-router'
import { useMessage } from 'naive-ui'
import { 
  NCard, NButton, NTabs, NTabPane, NForm, NFormItem, 
  NInput, NAlert, NSelect
} from 'naive-ui'

const router = useRouter()
const message = useMessage()

// Git å¸¸ç”¨å‘½ä»¤
const basicCommands = [
  { 
    name: 'åˆå§‹åŒ–ä»“åº“', 
    command: 'git init', 
    description: 'åˆ›å»ºä¸€ä¸ªæ–°çš„Gitä»“åº“' 
  },
  { 
    name: 'å…‹éš†ä»“åº“', 
    command: 'git clone https://github.com/username/repository.git', 
    description: 'å…‹éš†è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°' 
  },
  { 
    name: 'æ·»åŠ æ–‡ä»¶', 
    command: 'git add <filename>', 
    description: 'å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº' 
  },
  { 
    name: 'æ·»åŠ æ‰€æœ‰', 
    command: 'git add .', 
    description: 'å°†æ‰€æœ‰æ›´æ”¹æ·»åŠ åˆ°æš‚å­˜åŒº' 
  },
  { 
    name: 'æäº¤æ›´æ”¹', 
    command: 'git commit -m "æäº¤ä¿¡æ¯"', 
    description: 'æäº¤æš‚å­˜åŒºçš„æ›´æ”¹' 
  },
  { 
    name: 'æŸ¥çœ‹çŠ¶æ€', 
    command: 'git status', 
    description: 'æ˜¾ç¤ºå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„çŠ¶æ€' 
  }
]

const branchCommands = [
  { 
    name: 'åˆ—å‡ºåˆ†æ”¯', 
    command: 'git branch', 
    description: 'åˆ—å‡ºæœ¬åœ°æ‰€æœ‰åˆ†æ”¯' 
  },
  { 
    name: 'åˆ—å‡ºè¿œç¨‹åˆ†æ”¯', 
    command: 'git branch -r', 
    description: 'åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯' 
  },
  { 
    name: 'åˆ›å»ºåˆ†æ”¯', 
    command: 'git branch <branch-name>', 
    description: 'åˆ›å»ºæ–°çš„åˆ†æ”¯' 
  },
  { 
    name: 'åˆ‡æ¢åˆ†æ”¯', 
    command: 'git checkout <branch-name>', 
    description: 'åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯' 
  },
  { 
    name: 'åˆ›å»ºå¹¶åˆ‡æ¢', 
    command: 'git checkout -b <branch-name>', 
    description: 'åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯' 
  },
  { 
    name: 'åˆå¹¶åˆ†æ”¯', 
    command: 'git merge <branch-name>', 
    description: 'åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯' 
  }
]

const advancedCommands = [
  { 
    name: 'æ·»åŠ è¿œç¨‹ä»“åº“', 
    command: 'git remote add origin https://github.com/username/repository.git', 
    description: 'æ·»åŠ è¿œç¨‹ä»“åº“' 
  },
  { 
    name: 'æ¨é€åˆ°è¿œç¨‹', 
    command: 'git push -u origin main', 
    description: 'æ¨é€æœ¬åœ°åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“' 
  },
  { 
    name: 'æ‹‰å–æ›´æ–°', 
    command: 'git pull origin main', 
    description: 'ä»è¿œç¨‹ä»“åº“æ‹‰å–å¹¶åˆå¹¶æ›´æ–°' 
  },
  { 
    name: 'æŸ¥çœ‹æ—¥å¿—', 
    command: 'git log --oneline --graph', 
    description: 'ä»¥å›¾å½¢æ–¹å¼æŸ¥çœ‹æäº¤å†å²' 
  },
  { 
    name: 'æ’¤é”€æäº¤', 
    command: 'git revert <commit-hash>', 
    description: 'æ’¤é”€æŒ‡å®šçš„æäº¤' 
  },
  { 
    name: 'å˜åŸºæ“ä½œ', 
    command: 'git rebase main', 
    description: 'å°†å½“å‰åˆ†æ”¯å˜åŸºåˆ°mainåˆ†æ”¯' 
  }
]

// åˆ†æ”¯å›¾ç”Ÿæˆå™¨
const branchGraphConfig = ref({
  mainBranch: 'main',
  branchDefinition: `feature: main 50
bugfix: feature 30
merge bugfix feature
merge feature main`
})

const branchGraphOutput = ref(`main ----------------------------+
                            |
feature         +------------+-----+
                |                  |
bugfix          +-------+          |
                        |          |
                        +----------+
                                   |
                                   +`)

function generateBranchGraph() {
  // ç®€æ˜“å®ç°ï¼Œå®é™…åº”ç”¨éœ€è¦æ›´å¤æ‚çš„ç®—æ³•
  const { mainBranch, branchDefinition } = branchGraphConfig.value
  
  if (!branchDefinition.trim()) {
    message.warning('è¯·è¾“å…¥åˆ†æ”¯å®šä¹‰')
    return
  }
  
  try {
    // è¿™é‡Œæ˜¯ç®€å•çš„ç¤ºä¾‹è¾“å‡ºï¼Œå®é™…åº”ç”¨éœ€è¦è§£æåˆ†æ”¯å®šä¹‰å¹¶ç”Ÿæˆå›¾å½¢
    const lines = branchDefinition.split('\n')
    const branches = [mainBranch]
    
    // æå–æ‰€æœ‰åˆ†æ”¯å
    lines.forEach(line => {
      if (line.includes(':')) {
        const branch = line.split(':')[0].trim()
        if (!branches.includes(branch)) {
          branches.push(branch)
        }
      }
    })
    
    // ç”Ÿæˆä¸€ä¸ªç®€å•çš„ASCIIå›¾
    let graph = ''
    branches.forEach((branch, index) => {
      const indent = ' '.repeat(index * 2)
      graph += `${indent}${branch} ${'---'.repeat(4 - index)}\n`
      if (index < branches.length - 1) {
        graph += `${indent}|\n`
      }
    })
    
    branchGraphOutput.value = graph
    message.success('åˆ†æ”¯å›¾ç”ŸæˆæˆåŠŸ')
  } catch (error) {
    message.error('åˆ†æ”¯å›¾ç”Ÿæˆå¤±è´¥')
    branchGraphOutput.value = error instanceof Error ? `é”™è¯¯: ${error.message}` : 'æœªçŸ¥é”™è¯¯'
  }
}

// Commit æ¨¡æ¿
const commitTemplate = ref({
  type: 'feat',
  scope: '',
  subject: '',
  body: '',
  footer: ''
})

const commitTypeOptions = [
  { label: 'âœ¨ feat: æ–°åŠŸèƒ½', value: 'feat' },
  { label: 'ğŸ› fix: ä¿®å¤', value: 'fix' },
  { label: 'ğŸ“ docs: æ–‡æ¡£', value: 'docs' },
  { label: 'ğŸ’„ style: æ ·å¼', value: 'style' },
  { label: 'â™»ï¸ refactor: é‡æ„', value: 'refactor' },
  { label: 'âš¡ perf: æ€§èƒ½ä¼˜åŒ–', value: 'perf' },
  { label: 'âœ… test: æµ‹è¯•', value: 'test' },
  { label: 'ğŸ”§ chore: æ„å»º/ä¾èµ–', value: 'chore' }
]

const commitMessageOutput = ref(`feat: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½

å®ç°äº†åŸºäºJWTçš„è®¤è¯ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç™»å½•è¡¨å•å’ŒTokenå­˜å‚¨ã€‚
æ·»åŠ äº†è®°ä½å¯†ç åŠŸèƒ½å’Œè‡ªåŠ¨ç™»å½•é€‰é¡¹ã€‚

Closes #123`)

function generateCommitMessage() {
  const { type, scope, subject, body, footer } = commitTemplate.value
  
  if (!subject) {
    message.warning('è¯·å¡«å†™ç®€çŸ­æè¿°')
    return
  }
  
  let output = `${type}`
  if (scope) {
    output += `(${scope})`
  }
  output += `: ${subject}`
  
  if (body) {
    output += `\n\n${body}`
  }
  
  if (footer) {
    output += `\n\n${footer}`
  }
  
  commitMessageOutput.value = output
}

// å¤åˆ¶åˆ°å‰ªè´´æ¿
function copyToClipboard(text: string) {
  navigator.clipboard.writeText(text).then(() => {
    message.success('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
  }).catch(() => {
    message.error('å¤åˆ¶å¤±è´¥')
  })
}
</script>

<style scoped>
.tools-container {
  width: 100%;
  min-height: 100vh;
  padding: 0;
  background-color: white;
  overflow-y: auto;
}

.content-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 30px;
}

.command-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
}

.command-item {
  padding: 12px;
  border: 1px solid #eee;
  border-radius: 8px;
  background-color: #fafafa;
}

.command-name {
  font-weight: 600;
  margin-bottom: 8px;
}

.command-code {
  font-family: monospace;
  background-color: #f0f0f0;
  padding: 6px;
  border-radius: 4px;
  margin-bottom: 8px;
  font-size: 13px;
  white-space: nowrap;
  overflow: auto;
}

.command-desc {
  font-size: 13px;
  color: #666;
}

.branch-graph-output,
.commit-message-output {
  font-family: monospace;
  background-color: #f5f5f5;
  padding: 16px;
  border-radius: 8px;
  white-space: pre;
  overflow: auto;
  min-height: 200px;
  max-height: 400px;
  border: 1px solid #eee;
}

@media (max-width: 768px) {
  .content-container {
    padding: 15px;
  }
  
  .command-grid {
    grid-template-columns: 1fr;
  }
}
</style> 