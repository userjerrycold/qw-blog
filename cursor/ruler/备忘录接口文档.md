# 备忘录功能接口文档

## 1. 数据库表结构

```sql
DROP TABLE IF EXISTS aaa_hbyd.memo_management;
CREATE TABLE aaa_hbyd.memo_management (
    id bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
    title varchar(100) NOT NULL COMMENT '备忘录标题',
    content text COMMENT '备忘录内容',
    tag_code tinyint(2) DEFAULT 1 COMMENT '分类标签，1-工作 2-学习 3-生活 4-其他',
    is_todo tinyint(1) DEFAULT 0 COMMENT '是否为待办事项，0-否 1-是',
    due_date datetime DEFAULT NULL COMMENT '截止日期，仅当is_todo=1时有效',
    completed tinyint(1) DEFAULT 0 COMMENT '是否已完成，仅当is_todo=1时有效',
    author varchar(100) DEFAULT NULL COMMENT '作者',
    status tinyint(1) NOT NULL DEFAULT 1 COMMENT '状态，0-无效，1-有效',
    create_dt datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_dt datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (id),
    INDEX idx_tag_code (tag_code),
    INDEX idx_is_todo (is_todo),
    INDEX idx_due_date (due_date),
    INDEX idx_create_dt (create_dt)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COMMENT = '备忘录管理表';
```

## 2. API 接口详细说明

### 2.1 查询备忘录列表

**接口说明**：根据条件查询备忘录列表，支持分页、标签筛选和关键词搜索

**请求路径**：`/api/memo/search`

**请求方式**：`POST`

**请求参数**：
```json
{
  "username": "string",    // 用户名，必填
  "tagCode": 0,            // 标签代码，0表示全部，1-工作 2-学习 3-生活 4-其他，可选，默认0
  "keyword": "string",     // 关键词搜索，可选，默认空字符串
  "page": 1,               // 页码，可选，默认1
  "pageSize": 20           // 每页数量，可选，默认20
}
```

**响应参数**：
```json
{
  "code": 200,             // 状态码，200表示成功
  "msg": "success",        // 状态描述
  "data": {
    "list": [              // 备忘录列表
      {
        "id": 1,                           // 备忘录ID
        "title": "完成Vue项目开发",         // 标题
        "content": "需要实现备忘录功能...", // 内容
        "tagCode": 1,                      // 标签代码
        "tagName": "工作",                  // 标签名称
        "isTodo": true,                    // 是否为待办事项
        "dueDate": "2023-07-30 00:00:00",  // 截止日期
        "completed": false,                // 是否已完成
        "author": "qianhu",                // 作者
        "createDt": "2023-07-28 09:30:00", // 创建时间
        "updateDt": "2023-07-28 09:30:00"  // 更新时间
      }
    ],
    "total": 12,           // 总记录数
    "page": 1,             // 当前页码
    "pageSize": 20         // 每页数量
  }
}
```

### 2.2 创建备忘录

**接口说明**：创建一条新的备忘录记录

**请求路径**：`/api/memo/create`

**请求方式**：`POST`

**请求参数**：
```json
{
  "title": "string",          // 标题，必填
  "content": "string",        // 内容，可选
  "tagCode": 1,               // 标签代码，1-工作 2-学习 3-生活 4-其他，必填
  "isTodo": false,            // 是否为待办事项，可选，默认false
  "dueDate": "2023-08-01",    // 截止日期，当isTodo=true时有效，格式：yyyy-MM-dd或yyyy-MM-dd HH:mm:ss，可选
  "author": "string"          // 作者，必填
}
```

**响应参数**：
```json
{
  "code": 200,             // 状态码，200表示成功
  "msg": "success",        // 状态描述
  "data": {
    "id": 13               // 新创建的备忘录ID
  }
}
```

### 2.3 更新备忘录

**接口说明**：更新已有的备忘录记录

**请求路径**：`/api/memo/update`

**请求方式**：`POST`

**请求参数**：
```json
{
  "id": 1,                    // 备忘录ID，必填
  "title": "string",          // 标题，必填
  "content": "string",        // 内容，可选
  "tagCode": 1,               // 标签代码，1-工作 2-学习 3-生活 4-其他，必填
  "isTodo": false,            // 是否为待办事项，必填
  "dueDate": "2023-08-01",    // 截止日期，当isTodo=true时必填，格式：yyyy-MM-dd或yyyy-MM-dd HH:mm:ss
  "completed": false          // 是否已完成，当isTodo=true时有效，必填
}
```

**响应参数**：
```json
{
  "code": 200,             // 状态码，200表示成功
  "msg": "success",        // 状态描述
  "data": true             // 操作结果，true表示成功，false表示失败
}
```

### 2.4 删除备忘录

**接口说明**：删除指定ID的备忘录记录

**请求路径**：`/api/memo/delete`

**请求方式**：`POST`

**请求参数**：
```json
{
  "id": 1                  // 备忘录ID，必填
}
```

**响应参数**：
```json
{
  "code": 200,             // 状态码，200表示成功
  "msg": "success",        // 状态描述
  "data": true             // 操作结果，true表示成功，false表示失败
}
```

### 2.5 获取备忘录统计信息

**接口说明**：获取用户备忘录的统计信息，包括总数、待办数、标签分布等

**请求路径**：`/api/memo/statistics`

**请求方式**：`POST`

**请求参数**：
```json
{
  "username": "string"     // 用户名，必填
}
```

**响应参数**：
```json
{
  "code": 200,             // 状态码，200表示成功
  "msg": "success",        // 状态描述
  "data": {
    "total": 15,                        // 总备忘录数
    "todoCount": 8,                     // 待办事项总数
    "completedCount": 5,                // 已完成事项数
    "todayTodoCount": 3,                // 今日待办数
    "tagDistribution": [                // 各标签分布
      { 
        "tagCode": 1, 
        "tagName": "工作", 
        "count": 6 
      },
      { 
        "tagCode": 2, 
        "tagName": "学习", 
        "count": 4 
      },
      { 
        "tagCode": 3, 
        "tagName": "生活", 
        "count": 3 
      },
      { 
        "tagCode": 4, 
        "tagName": "其他", 
        "count": 2 
      }
    ],
    "dueDateDistribution": [            // 各日期待办分布
      { "date": "2023-07-29", "count": 2 },
      { "date": "2023-07-30", "count": 1 },
      { "date": "2023-08-01", "count": 3 }
      // 更多日期...
    ]
  }
}
```

### 2.6 切换待办事项完成状态

**接口说明**：快速切换待办事项的完成状态

**请求路径**：`/api/memo/toggleStatus`

**请求方式**：`POST`

**请求参数**：
```json
{
  "id": 1,                 // 备忘录ID，必填
  "completed": true        // 是否已完成，必填
}
```

**响应参数**：
```json
{
  "code": 200,             // 状态码，200表示成功
  "msg": "success",        // 状态描述
  "data": true             // 操作结果，true表示成功，false表示失败
}
```

## 3. 前端接口封装示例

```typescript
// src/services/api.ts 中添加以下代码

// 备忘录接口类型
export interface Memo {
  id: number;
  title: string;
  content: string;
  tagCode: number;
  tagName?: string;
  isTodo: boolean;
  dueDate: string | null;
  completed: boolean;
  author: string;
  createDt: string;
  updateDt: string;
}

// 备忘录搜索参数
export interface MemoSearchParams {
  username: string;
  tagCode?: number;
  keyword?: string;
  page?: number;
  pageSize?: number;
}

// 备忘录创建参数
export interface MemoCreateParams {
  title: string;
  content?: string;
  tagCode: number;
  isTodo: boolean;
  dueDate?: string;
  author: string;
}

// 备忘录更新参数
export interface MemoUpdateParams {
  id: number;
  title: string;
  content?: string;
  tagCode: number;
  isTodo: boolean;
  dueDate?: string;
  completed?: boolean;
}

// 标签统计接口
export interface TagStat {
  tagCode: number;
  tagName: string;
  count: number;
}

// 日期统计接口
export interface DateStat {
  date: string;
  count: number;
}

// 备忘录统计响应接口
export interface MemoStatistics {
  total: number;
  todoCount: number;
  completedCount: number;
  todayTodoCount: number;
  tagDistribution: TagStat[];
  dueDateDistribution: DateStat[];
}

// 搜索备忘录
export function searchMemos(params: MemoSearchParams) {
  return request({
    url: '/api/memo/search',
    method: 'post',
    data: params
  });
}

// 创建备忘录
export function createMemo(params: MemoCreateParams) {
  return request({
    url: '/api/memo/create',
    method: 'post',
    data: params
  });
}

// 更新备忘录
export function updateMemo(params: MemoUpdateParams) {
  return request({
    url: '/api/memo/update',
    method: 'post',
    data: params
  });
}

// 删除备忘录
export function deleteMemo(id: number) {
  return request({
    url: '/api/memo/delete',
    method: 'post',
    data: { id }
  });
}

// 获取备忘录统计
export function getMemoStatistics(username: string) {
  return request({
    url: '/api/memo/statistics',
    method: 'post',
    data: { username }
  });
}

// 切换待办状态
export function toggleMemoStatus(id: number, completed: boolean) {
  return request({
    url: '/api/memo/toggleStatus',
    method: 'post',
    data: { id, completed }
  });
}
```

## 4. 错误码定义

| 错误码 | 描述 |
|--------|------|
| 200 | 成功 |
| 400 | 请求参数错误 |
| 401 | 未授权 |
| 403 | 权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 5. 接口实现建议

1. 使用Spring Boot框架实现后端接口
2. 使用Mybatis-Plus进行数据库操作
3. 实现统一的响应格式和异常处理机制
4. 对重要操作增加日志记录
5. 考虑添加缓存机制优化统计查询性能 